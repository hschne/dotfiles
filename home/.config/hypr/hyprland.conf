# Hyprland config - ported from i3
# https://wiki.hypr.land/Configuring/

################
### MONITORS ###
################

# Laptop display (high DPI ~225 PPI) - scale 1.5x
# Effective resolution: 1920x1280
monitor = eDP-1, 2880x1920@120, 0x0, 1.5

# External monitors (standard DPI) - no scaling
# Position to the right of laptop. Adjust as needed.
monitor = DP-1, preferred, 1920x0, 1
monitor = DP-2, preferred, 1920x0, 1
monitor = HDMI-A-1, preferred, 1920x0, 1
monitor = HDMI-A-2, preferred, 1920x0, 1

# Fallback for any other monitor
monitor = , preferred, auto, 1

###################
### MY PROGRAMS ###
###################

$terminal = kitty
$fileManager = nautilus
$menu = walker
$browser = firefox
$editor = nvim

################
# ENVS

#################
### AUTOSTART ###
#################

exec-once = uwsm-app -- kanshi
exec-once = uwsm-app -- mako
exec-once = uwsm-app -- waybar
exec-once = uwsm-app -- walker --gapplication-service
exec-once = uwsm-app -- hypridle
exec-once = uwsm-app -- hyprsunset
exec-once = uwsm-app -- swayosd-server
exec-once = uwsm-app -- easyeffects --gapplication-service
exec-once = uwsm-app -- $HOME/.scripts/nudlsieb $HOME/Documents/Wiki/reminders.md

# Wallpaper
exec-once = uwsm-app -- swaybg -i $(fd --full-path ~/Pictures/Backgrounds/ --type=file | shuf -n1) -m fill

# Polkit agent for auth dialogs
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

# Slow app launch fix -- set systemd vars
exec-once = systemctl --user import-environment $(env | cut -d'=' -f 1)
exec-once = dbus-update-activation-environment --systemd --all

#############################
### ENVIRONMENT VARIABLES ###
#############################

env = XCURSOR_SIZE,24
env = HYPRCURSOR_SIZE,24

# Force all apps to use Wayland
env = GDK_BACKEND,wayland,x11,*
env = QT_QPA_PLATFORM,wayland;xcb
env = QT_STYLE_OVERRIDE,kvantum
env = SDL_VIDEODRIVER,wayland
env = MOZ_ENABLE_WAYLAND,1
env = ELECTRON_OZONE_PLATFORM_HINT,wayland
env = OZONE_PLATFORM,wayland
env = XDG_SESSION_TYPE,wayland

# Allow better support for screen sharing (Google Meet, Discord, etc)
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_DESKTOP,Hyprland

ecosystem {
  no_update_news = true
}

#####################
### LOOK AND FEEL ###
#####################

general {
    gaps_in = 5
    gaps_out = 10
    border_size = 1

    # Tokyo Night colors (matching i3 config)
    col.active_border = rgba(bb9af7ff)
    col.inactive_border = rgba(32344aff)

    resize_on_border = true
    allow_tearing = false
    layout = dwindle
}

decoration {
    rounding = 0

    active_opacity = 1.0
    inactive_opacity = 1.0

    shadow {
        enabled = true
        range = 4
        render_power = 3
        color = rgba(1a1a1aee)
    }

    blur {
        enabled = true
        size = 3
        passes = 1
        vibrancy = 0.1696
    }
}

animations {
    enabled = yes

    bezier = easeOutQuint, 0.23, 1, 0.32, 1
    bezier = easeInOutCubic, 0.65, 0.05, 0.36, 1
    bezier = linear, 0, 0, 1, 1
    bezier = almostLinear, 0.5, 0.5, 0.75, 1
    bezier = quick, 0.15, 0, 0.1, 1

    animation = global, 1, 10, default
    animation = border, 1, 5.39, easeOutQuint
    animation = windows, 1, 4.79, easeOutQuint
    animation = windowsIn, 1, 4.1, easeOutQuint, popin 87%
    animation = windowsOut, 1, 1.49, linear, popin 87%
    animation = fadeIn, 1, 1.73, almostLinear
    animation = fadeOut, 1, 1.46, almostLinear
    animation = fade, 1, 3.03, quick
    animation = layers, 1, 3.81, easeOutQuint
    animation = layersIn, 1, 4, easeOutQuint, fade
    animation = layersOut, 1, 1.5, linear, fade
    animation = fadeLayersIn, 1, 1.79, almostLinear
    animation = fadeLayersOut, 1, 1.39, almostLinear
    animation = workspaces, 1, 1.94, almostLinear, fade
}

dwindle {
    pseudotile = true
    preserve_split = true
}

master {
    new_status = master
}

misc {
    force_default_wallpaper = 0
    disable_hyprland_logo = true
}

#############
### INPUT ###
#############

input {
    kb_layout = us
    kb_options = caps:swapescape,compose:ralt

    follow_mouse = 1
    sensitivity = 0

    touchpad {
        natural_scroll = false
    }
}

misc {
    key_press_enables_dpms = true
    mouse_move_enables_dpms = true
}

###################
### KEYBINDINGS ###
###################

$mainMod = SUPER

# Core bindings
bind = $mainMod, Return, exec, $terminal
bindd = $mainMod SHIFT, Q, Kill, killactive,
bindd = $mainMod, D, Menu, exec, $menu
bindd = $mainMod, P, Power Menu, exec, ~/.scripts/power-menu

# Applications
bindd= $mainMod, X, Todo, exec, $terminal $editor ~/Documents/Wiki/todo.txt
bindd = $mainMod, F, File Manager, exec, $fileManager
bindd = $mainMod, B, Browser, exec, $browser
bindd = $mainMod, N, Neovim, exec, $terminal -e nvim
bindd = $mainMod, T, Top, exec, $terminal -e btop

# Focus movement (vim-style, matching i3)
bind = $mainMod, H, movefocus, l
bind = $mainMod, J, movefocus, d
bind = $mainMod, K, movefocus, u
bind = $mainMod, L, movefocus, r
bind = $mainMod, Left, movefocus, l
bind = $mainMod, Down, movefocus, d
bind = $mainMod, Up, movefocus, u
bind = $mainMod, Right, movefocus, r

# Move windows
bind = $mainMod SHIFT, Left, movewindow, l
bind = $mainMod SHIFT, Down, movewindow, d
bind = $mainMod SHIFT, Up, movewindow, u
bind = $mainMod SHIFT, Right, movewindow, r

# Workspace prev/next on output 
bind = $mainMod CTRL, H, workspace, m-1
bind = $mainMod CTRL, L, workspace, m+1

# Move workspace to monitor
bind = $mainMod CTRL SHIFT, Left, movecurrentworkspacetomonitor, l
bind = $mainMod CTRL SHIFT, Right, movecurrentworkspacetomonitor, r

# Split orientation (dwindle)
bind = $mainMod, S, togglesplit,
bind = $mainMod, V, layoutmsg, preselect d

# Fullscreen
bind = $mainMod, F, fullscreen, 0

# Floating
bind = $mainMod SHIFT, Space, togglefloating,
bind = $mainMod, Space, cyclenext, floating

# Config management
bind = $mainMod SHIFT, W, exec, pkill waybar; uwsm-app -- waybar
bind = $mainMod SHIFT, R, exec, hyprctl reload

# Lock screen
bind = $mainMod SHIFT, O, exec, hyprlock

# Screenshot (with satty for annotation)
bind = , Print, exec, grim -g "$(slurp)" - | satty -f -
bind = $mainMod, Print, exec, grim - | satty -f -
bind = $mainMod SHIFT, Print, exec, grim -g "$(slurp)" - | wl-copy

# Color picker
bind = $mainMod SHIFT, P, exec, hyprpicker -a

# Switch workspaces
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Move window to workspace
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Scroll through workspaces
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1

# Move/resize with mouse
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Media keys (using swayosd for visual feedback)
bindel = , XF86AudioRaiseVolume, exec, swayosd-client --output-volume raise
bindel = , XF86AudioLowerVolume, exec, swayosd-client --output-volume lower
bindel = , XF86AudioMute, exec, swayosd-client --output-volume mute-toggle
bindel = , XF86AudioMicMute, exec, swayosd-client --input-volume mute-toggle

# Brightness (using swayosd for visual feedback)
bindel = , XF86MonBrightnessUp, exec, swayosd-client --brightness raise
bindel = , XF86MonBrightnessDown, exec, swayosd-client --brightness lower

# Media player controls
bindl = , XF86AudioPlay, exec, playerctl play-pause
bindl = , XF86AudioPause, exec, playerctl play-pause
bindl = , XF86AudioNext, exec, playerctl next
bindl = , XF86AudioPrev, exec, playerctl previous

# Common Utilities

# Notifications
bindd = SUPER, COMMA, Dismiss last notification, exec, makoctl dismiss
bindd = SUPER SHIFT, COMMA, Dismiss all notifications, exec, makoctl dismiss --all
bindd = SUPER CTRL, COMMA, Toggle silencing notifications, exec, makoctl mode -t do-not-disturb && makoctl mode | grep -q 'do-not-disturb' && notify-send "Silenced notifications" || notify-send "Enabled notifications"
bindd = SUPER ALT, COMMA, Invoke last notification, exec, makoctl invoke
bindd = SUPER SHIFT ALT, COMMA, Restore last notification, exec, makoctl restore

# Speech-to-text (kept from original)
bind = $mainMod ALT, D, exec, /usr/lib/hyprwhspr/config/hyprland/hyprwhspr-tray.sh record

##############################
### SUBMAPS (like i3 modes) ##
##############################

# Exit mode (like i3's "Exit (L)ogout, (R)eboot, (P)oweroff")
bind = $mainMod SHIFT, E, submap, exit
submap = exit
bind = $mainMod, L, exit,
bind = $mainMod, R, exec, systemctl reboot
bind = $mainMod, P, exec, systemctl poweroff
bind = , Return, submap, reset
bind = , Escape, submap, reset
submap = reset

# Resize mode
bind = $mainMod, R, submap, resize
submap = resize
binde = , H, resizeactive, -20 0
binde = , J, resizeactive, 0 20
binde = , K, resizeactive, 0 -20
binde = , L, resizeactive, 20 0
binde = , Left, resizeactive, -20 0
binde = , Down, resizeactive, 0 20
binde = , Up, resizeactive, 0 -20
binde = , Right, resizeactive, 20 0
bind = , Return, submap, reset
bind = , Escape, submap, reset
bind = $mainMod, R, submap, reset
submap = reset

##############################
### WINDOW RULES #############
##############################

# Basics
windowrule = suppress_event maximize, match:class .*

# Fix some dragging issues with XWayland
windowrule = no_focus on, match:class ^$, match:title ^$, match:xwayland 1, match:float 1, match:fullscreen 0, match:pin 0

# Workspace assignments
windowrule = match:class ^([Ff]irefox.*)|([Cc]hromium.*)$, workspace 2
windowrule = match:title ^(Spotify.*)$, workspace 5
windowrule = match:class ^([Ss]lack.*)$, workspace 6
windowrule = match:class ^([Ss]ignal.*)$, workspace 6
windowrule = match:class ^([Dd]iscord.*)$, workspace 6

# Float certain windows
windowrule = match:class ^(org.speedcrunch.speedcrunch)$, float true
windowrule = match:class ^(org.pulseaudio.pavucontrol)$, float true
windowrule = match:class ^(nm-connection-editor)$, float true
windowrule = match:class ^(blueman-manager)$, float true
windowrule = match:title ^(Picture-in-Picture)$, float true

# hyprwhspr - Toggle mode (added by hyprwhspr setup)
# Press once to start, press again to stop
bindd = SUPER ALT, D, Speech-to-text, exec, /usr/lib/hyprwhspr/config/hyprland/hyprwhspr-tray.sh record
